<style>*{vertical-align:baseline}body{height:100%;margin:0;padding:0;width:99.708%;overflow:hidden}#cachedTrans>span,small{font-size:xx-small;align-self:center}.tunatumaMsg>*>*>.buttonholder{display:none}li#confirmCachedEntry>div,li#confirmTransactionEntry>div{width:90%;justify-content:space-between}li#confirmCachedEntry>div>div{justify-content:space-between}li#confirmCachedEntry>div>div>button{width:auto}li#confirmCachedEntry>div>div>div>a,li#confirmTransactionEntry>span>a{text-wrap:nowrap;text-decoration:none;padding-right:5px;width:100%;background:0 0}li#confirmCachedEntry>div>div>div>a{color:#fff}span{font-weight:bolder}li{margin-bottom:1px}button{font-size:11px;width:-webkit-fill-available}body{height:100%;margin:0;padding:0;width:99.708%}sub{font-weight:100;letter-spacing:1px;text-decoration-line:none}h2{margin-block-start:19px;margin-top:0}#filter-dialog>div>li{border-bottom:1px solid #a7a7a7;display:flex;flex-direction:row;justify-content:space-between;padding-left:5px;padding-right:5px}.flex-row,li{display:flex;flex-direction:row;margin-bottom:5px}.half-row{display:flex;flex:0 0 50%!important}.flex-column{display:flex;flex-direction:column}#results>li>a{font-size:3vw;justify-content:center;margin:0;width:100%}a{text-decoration:none;border:none;display:flex;padding:2px;color:inherit}#appStates{border-top:1px solid #000}#mywebview.wholesale_sale>* button>span,#productsview.wholesale_sale>* li>a>span{background-color:#00c853}#mywebview.wholesale_sale>#news_display>* .highlight-border{border-color:#00c853!important}#mywebview.wholesale_purchase_delivered>* button>span,#productsview.wholesale_purchase_delivered>* li>a>span{background-color:#a200ff;color:#fff}#mywebview.wholesale_purchase_delivered>#news_display>* .highlight-border{border-color:#a200ff!important}#mywebview.wholesale_purchase>* button>span,#productsview.wholesale_purchase>* li>a>span{background-color:#ffc400;color:#000}#mywebview.wholesale_purchase>#news_display>* .highlight-border{border-color:#ffc400!important}#mywebview.sent2_bank>div>* button>span,#productsview.sent2_bank>* li>a>span{background-color:#d50000}#mywebview.sent2_bank>#news_display>* .highlight-border{border-color:#d50000!important}#mywebview.stocktake>div>* button>span,#productsview.stocktake>* li>a>span{background-color:#e1e1e1;color:#000}#mywebview.stocktake>#news_display>* .highlight-border{border-color:#e1e1e1!important}#results>li>a{flex-flow:column;padding:0 1%;place-content:space-between;text-decoration:none;white-space:nowrap}#results>li>a>span{align-self:stretch;background-color:#483d8b;color:ivory;font-size:small;margin-bottom:0;pointer-events:none}#filter-dialog>div>li.selected,#myinputbar input:focus,#results>li>a.pressed,#results>li>a:active,#results>li>a:hover,.processed{background-color:#faf9cb;border:2px solid #a4a4a4;border-color:#000;opacity:1!important;padding-top:0}#productsview>* li>a>input{display:none}#productsview>* li>a.pressed>input,#productsview>* li>a:active>input,#productsview>* li>a:hover>input{display:flex}li.product.hovering{margin:0;order:-1;position:sticky;min-width:60%;opacity:1;top:0;z-index:99}li.product.alcohol{border:2px solid red}.btn{align-items:center;background-color:var(--background-color);border:1px solid var(--border-color);box-shadow:0 .2rem .4rem #0006 0 -.3rem .6rem #0003 inset;color:var(--color);font-family:inherit;font-weight:900;justify-content:center;padding:.6rem;position:relative;transition:box-shadow 64ms ease-out;--background-color:#d8d8d8;--border-color:#c7c7c7;--color:#000}.btn:after{background-color:#fff;content:"";filter:blur(.15rem);height:12.5%;left:12.5%;position:absolute;top:.15rem;transition:opacity 64ms ease-out;width:75%}.btn:active{box-shadow:0 0 0 #0006 0 .4rem 1rem #0000004d inset}.btn:active:after{opacity:0}.btn:hover{border:1px solid #000}.btn-color-wholesale_sale{--background-color:#00c853;--border-color:#00a243;--color:#fff}.btn-color-wholesale_sale:active{--color:#ececec}.btn-color-wholesale_purchase{--background-color:#ffc400;--border-color:#d9a700;--color:#3e2723}.btn-color-wholesale_purchase:active{--color:#261815}.btn-color-sent2_bank{--background-color:#d50000;--border-color:#af0000;--color:#fff}.btn-color-sent2_bank:active{--color:#ececec}.btn-color-wholesale_purchase_delivered{--background-color:#483d8b;--border-color:#544b89;--color:#fff}.btn-color-wholesale_purchase_delivered:active{--color:#ececec}.pressed,button:active{border-color:#817;box-shadow:inset 0 0 5px #a9a;color:#817;text-decoration:overline}#numberpadfunctions{display:flex;flex-direction:column;justify-content:space-between;width:60px}#istax{color:#8b0000;display:none;font-weight:bolder}#submitbuttonholder>a{height:61px}#submitbuttonholder>div{display:flex;flex-flow:row}#myinputbar{background:#fffaf0;justify-content:space-between;padding:0 2px 0;position:sticky;top:0}#myinputbar>div{display:contents}#myinputbar>div>div{display:inline-flex;justify-content:flex-end}#myinputbar input{-moz-box-shadow:0 -1px .1px 3px #0000003d inset;-webkit-box-shadow:0 -1px .1px 3px #0000003d inset;border-left:none;border-right:none;border-top:none;box-shadow:0 -1px .1px 3px #0000003d inset;font-weight:bolder;text-align:center;width:100%}#myinputbar>div>input:active{background:bottom;border:2px solid #000;border-color:#8b4513}#myinputbar * span{background:#f0f8ff;border:1px solid #000;border-color:#deb887;font-size:3VW;max-width:20%;padding-left:2px;padding-right:2px;white-space:nowrap}#search{width:280%!important}#feedbackpack>button{height:100%}#feedbackpad,.disabled,.hidden,.hiddenpreview{display:none!important;height:0;visibility:hidden;width:0}#resultpad{background:#f5f5f5;display:block;height:45%;margin:0;margin-top:3px;overflow-x:clip;overflow-y:auto;padding:2px;z-index:0;position:relative}#entries{text-align:left}#result_display{font-family:monospace;height:100%;padding-left:3px;text-align:left;width:100%}div#result_display>ul{padding-left:0;align-items:baseline}div#result_display>ul>li.total{position:sticky;bottom:0;border-top:1px solid #efefef;background-color:#f5f5f5;width:70%;font-weight:700}div#result_display>ul>li>span{min-width:245px;align-items:baseline;font-weight:100}div#result_display>ul>li>div>button{border:none;background-color:transparent;margin-left:10px}div#result_display>ul>li>span>a{border-bottom:1px solid #deb887;margin:3px;border-top:0;background-color:transparent;text-decoration:solid;padding-top:none;font-weight:100}#mywebview2{bottom:0;height:97%;margin:0;padding:0;width:100%}.loading-content{z-index:90}#productsview{border:1px solid #000;overflow-x:HIDDEN;overflow-y:auto;height:-webkit-fill-available;position:relative;z-index:10}#mysubmitbar,li.product>span{display:flex;place-content:space-between}#submitbuttonholder{width:-webkit-fill-available}#submitbuttonholder.hyper{bottom:46%;left:0;position:fixed;width:98%}#myinputbar.hyper{max-height:21px;min-width:100%;position:relative}#mywebview3>div>.righthalf>a.btn{height:40%;padding:1%}#results{display:flex;flex-wrap:wrap;top:0;left:0;padding:0;margin:0;list-style-type:none;overflow-x:clip;overflow-y:auto;position:sticky;max-height:100%}#results li{border:.2px solid #ccc;display:flex;flex:1 0 auto;flex-basis:auto;flex-grow:1;margin:2px}@media (min-width:100px){#results li{flex-basis:calc(50% - 10px)}#results>li>a{font-size:5vw;letter-spacing:2px}#results>li>a>span{margin-top:2px}}@media (min-width:500px){#results li{flex-basis:calc(33.33% - 10px)}#results>li>a{font-size:3vw}}@media (min-width:700px){#results li{flex-basis:calc(25% - 10px)}}@media (min-width:900px){#results li{flex-basis:calc(20% - 10px)}}#filter-dialog,#processmsg-dialog,.mypopupdialog{background-color:#fff;border:1px solid #ccc;box-shadow:0 2px 5px #0003;display:flex;flex-direction:column;justify-content:space-around;left:50%;padding:20px;position:fixed;top:50%;transform:translate(-50%,-50%);width:fit-content;z-index:90}.mypopupdialog>*{display:flex;flex-direction:column;padding:5px;padding-top:10px}.mypopupdialog>*>li>a{border:none;text-decoration:none}.mypopupdialog>.buttonholder{display:flex;margin-top:10px}.mypopupdialog>button{margin:3px;position:absolute;right:10px;top:10px}#filter-categories{list-style:none;padding:0}#filter-categories li{margin-bottom:5px}#filter-categories input[type=checkbox]{margin-left:5px}li.product{display:none!important;width:fit-content;opacity:.55}li.product.active{display:block!important}#mywebview3{border:2px solid #000;bottom:0;display:flex;height:22px;position:fixed;width:99.4%}#cachedTrans{align-items:center;flex-basis:max-content;max-height:20px}#cachedTrans>span{border-bottom:1px solid #000;width:100%}.notbutton,.notbutton>*{background-color:transparent!important;border:none}.loading-content{background-color:#000c;border-radius:10px;color:#fff;display:flex;flex-direction:column;height:60%;justify-content:space-around;left:50%;padding:20px;position:fixed;text-align:center;top:50%;transform:translate(-50%,-50%);width:65%}#loading-text>code>ul{margin-left:0;margin-top:0;padding-left:0;text-align:left}#btnClose,#close-dialog{height:20px;position:fixed;right:1px;top:1px;width:20px}#cachedTrans>div>span.part1{background:0 0;border-bottom:none;border-left:1px solid #000;border-radius:4px;border-right:1px solid #000;border-top:none;font-size:revert;margin-left:10px;padding-left:4px;padding-right:4px;width:max-content}#myModal{margin:auto;padding:0;width:80%}#myModal>.editvalues{flex-direction:row;display:flex;position:relative;max-height:25;flex-wrap:wrap;padding-bottom:20px;text-align:-webkit-left;justify-content:space-between}#myModal>.editvalues>*{text-wrap:nowrap;margin:-3px;margin-left:5px;margin-right:5px;margin-top:3px;text-align:center;background-color:#fff;color:#000;width:max-content;padding-left:4px;padding-right:4px;font-stretch:ultra-condensed}#myModal>.editvalues>.notyet{background-color:transparent;color:#fff;border:none}#edit_multiplier{max-width:60px}#myModal>.editvalues>input.disabledfont{color:#fff}#myModal>.buttonholder{margin-top:10px}.selectproduct{border:1px solid gray;height:200px;overflow-y:auto;flex-flow:wrap}.selectproduct>li>a>input{display:none}</style><div id=mywebview class=wholesale_sale style=min-height:100%;display:block><div id=news_display style=display:flex;flex-direction:row;text-wrap:nowrap;justify-content:space-between><button style=display:-webkit-inline-box;-webkit-box-align:center;width:fit-content;display:flex;background:center;align-items:center>📆&nbsp;<div id=date onclick=getShopDate()><script>var date=new Date,mydate=date.getDate()+"/"+eval(date.getMonth()+1)+"/"+eval(date.getFullYear());document.getElementById("date").innerHTML=mydate</script></div></button><div id=appStates class=flex-column style=width:100%><button id=appState class=highlight-border><span>💰</span>MAUZO &nbsp;</button></div><button style=display:-webkit-inline-box;-webkit-box-align:center;width:65px;display:flex;background:center;align-items:center;margin-top:.9px onclick=getwarehouseName() id=warehouseName></button></div><div id=mywebview2 class=flex-column><div id=resultpad class=flex-column><div id=result_display><ul></ul></div></div><div id=myinputbar class=flex-row><input id=search placeholder="🔍 Tafuta Kinwaji"> <input disabled class="disabled highlight-border" type=number id=inputnumber_change placeholder=Lipa><button id=filter onclick=showFilterDialog() class=functionpad>🎚️</button><button disabled id=btnSend2Cache onclick=chooseToAddTransactionToCache(event) class="functionpad disabled">➡️</button><button id=cachedTrans class="flex-row notbutton"><div style=margin-top:-40px;min-width:100px><p class=hiddenpreview style=color:#ff0;background-color:#000!important>BADO REPOTI<sub style=white-space:nowrap>👇🏽 HAIJATUMWA ! 👇🏽</sub></p><span class="part2 highlight-border" style="border:none;background:0 0;font-size:revert">-</span><span class="part1 highlight-border">-</span></div></button></div><div id=productsview class=wholesale_sale><ul id=results></ul></div><div class=flex-column><div id=mysubmitbar class="flex-row hidden"><div id=numberpadfunctions><button id=istax class=functionpad>T</button></div><div id=submitbuttonholder><a id=submitbutton href=/#+ style=flex-direction:column-reverse;justify-content:space-around;text-underline-position:under class="submitbutton togglewholesale_sale btn"><label><span>💰</span>MAUZO &nbsp;</label><label>Peleka</label></a></div></div></div></div></div><div id=loading-screen class=hidden><div class=loading-content><h2 id=loading-title class=sr-only>Tafadhali Subiri</h2><div class=spinner-border role=status><small id=loading-subtitle></small></div><div id=loading-text class=loading-text style="border-bottom:1px solid #f5f5f5;overflow-y:auto;height:min-content;max-height:185px">...</div><div class=buttonholder style=display:flex;flex-direction:row;margin-top:15px></div></div></div><div id=choose-mode class="hidden mypopupdialog"><h2 id=selectmode>Select Mode</h2><ul><li><a href=# onclick='changeMode("0")'><span>💰</span>MAUZO &nbsp;</a></li><li><a href=# onclick='changeMode("2")'><span>➕</span>UPOKEZI &nbsp;</a></li><li><a href=# onclick='changeMode("1")'><span>🤌🏽</span>MALIPO &nbsp;</a></li><li><a href=# onclick='changeMode("3")'><span>#️⃣</span>STOCK &nbsp;</a></li><li class=hidden><a href=# onclick='changeMode("4")'><span>💱</span>MANUNUZI &nbsp;</a></li></ul></div><input id=clipboard class=hidden value=Alrada style=max-height:0 placeholder="" title=clipboard><div id=filter-dialog class="hidden mypopupdialog"></div><div id=querydialog class="hidden mypopupdialog" style=width:95%><input id=query title=query placeholder="" style=width:100%></div><div id=processmsg-dialog class="hidden mypopupdialog"></div><script>function changeMode(index=""){var oldstate=appStates[currentAppStateIndex];""==index?currentAppStateIndex++:currentAppStateIndex=eval(index);var appStates_btn=document.querySelector("#appStates");appStates_btn.classList.remove(`btn-color-${oldstate}}`),document.querySelector("#productsview").className="";var local_appstate=appStates[currentAppStateIndex];switch(local_appstate){case"wholesale_sale":status_display="<span>💰</span> MAUZO  &nbsp;";break;case"sent2_bank":status_display="<span>🤌🏽</span> MALIPO  &nbsp;";break;case"wholesale_purchase_delivered":status_display="<span>➕</span> UPOKEZI  &nbsp;";break;case"wholesale_purchase":status_display="<span>💱</span> MANUNUZI  &nbsp;";break;case"stocktake":status_display="<span>#️⃣</span> STOCK  &nbsp;"}document.querySelector("#mywebview").classList.value="",document.querySelector("#mywebview").classList.add(local_appstate),document.querySelector("#productsview").classList.add(local_appstate),appStates_btn.classList.add("btn-color-"+local_appstate),document.querySelector("#appState").innerHTML=status_display,document.querySelector("#submitbutton").innerHTML=status_display+"<label>Peleka</label>",document.querySelector("#cachedTrans>div>.part1").innerHTML=cachedTransCount[appStates[currentAppStateIndex]]?cachedTransCount[appStates[currentAppStateIndex]]:0,document.querySelector("#cachedTrans>div>.part2").innerHTML=cachedTransCashTotal[appStates[currentAppStateIndex]]?cachedTransCashTotal[appStates[currentAppStateIndex]].toLocaleString("en-US").replace(/\.00/g,""):0,clearvalues(),createProductsView(),closeFilterDialog()}const month=date.getMonth(),day=date.getDate(),hour=date.getUTCHours()+3,minute=date.getMinutes();let partOfDay;function wait(e){for(var t=(new Date).getTime(),a=t;a<t+e;)a=(new Date).getTime()}function show(e,t=!0,a=!0,r=!0){if(-1==window.location.href.indexOf("http://127.0.0.1:3000/")){try{a&&setClip("show():"+e,!1),r&&flashLong(e)}catch(e){}t&&wait(5e3)}else console.log("log: "+e)}function goto(e){-1==window.location.href.indexOf("http://127.0.0.1:3000/")?window.location.href=e:console.log("goto: "+e)}partOfDay=hour>=5&&hour<12?"Asubuhi":hour>=12&&hour<18?"Mchana":hour>=18&&hour<21?"Jioni":"Saa za Kufunga",console.log(`Siku ya ${partOfDay}.`),String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)});const appStates=["wholesale_sale","sent2_bank","wholesale_purchase_delivered","stocktake"],appStateMarks=["ӿ","$","++","#"];let specialTransType="",extraTransDetails="",BreakException={},isMultTextArray={},products_jsonString={},suppliers_jsonString,currentAppStateIndex=0,names=[],categories={},writtenInSearch="",editingquery="",staffName="",warehouseName="HQ",queryLog="",responseClone="";confirmAddReportToCache=function(){},confirmSendReportRightAway=function(){},confirmFormYes=function(){},confirmFormNo=function(){},confirmFormEdit=function(){},finalResponseMsg="",newlink="",inputnum="",iswholesale_purchaseText="",prefix="";var currentFocusedProduct="",oldFocusedProduct="",cachedTransObjectString=[],cachedTransObjectJson=[],cachedTransCount=[],cachedTransCashTotal=[],cachedTempTrans2Process=[],cachedTransactionQueries=[],results=document.getElementById("results");function getwarehouseName(){warehouseName=prompt("Ingiza Jina la shop","HQ"),null!=warehouseName?document.getElementById("warehouseName").innerHTML=warehouseName:warehouseName="HQ"}function getShopDate(){mydate=prompt("Ingiza Tarehe MFANO: 31/1/2025",document.getElementById("date").innerHTML.replaceAll("&nbsp;","")),null!=mydate?document.getElementById("date").innerHTML=mydate:mydate=document.getElementById("date").innerHTML}try{if(-1==window.location.href.indexOf("http://127.0.0.1:3000/")){try{if(global("ALDSETTING"))var settingsObj=JSON.parse(global("ALDSETTING"));if(global("ALRADAGOOGLEKEY"))var key=JSON.parse(gloal("ALRADAGOOGLEKEY"))}catch(e){}loadCachedTrans()}else staffName="Al";if(fetch("alradasettings.json").then((e=>(responseClone=e.clone(),e.ok?e.json():(responseClone.text().then((function(e){show("recieved the following: "+e)})),e.text().then((e=>{throw new Error("Server response: "+e,!1,!0)})))))).then((e=>{settingsObj=e,loadCachedTrans(),createProductsView()})).catch((e=>{})),-1==window.location.href.indexOf("http://127.0.0.1:3000/"))try{global("ALRADAUSER")&&(staffName=global("ALRADAUSER"));var alrada_lastreply=global("ALRADALASTREPLY")}catch(e){}staffName=""==staffName?"XX":staffName}catch(e){show("error laoding defaults: "+e.stack);var alrada_lastreply=".* ,mauzo yako yana kadiriya ..... ...... ..... ..... ..... .... ...... ........"}function loadCachedTrans(){try{if(-1==window.location.href.indexOf("http://127.0.0.1:3000/"))try{for(const TransType in appStates)if(global(`ALDCACHE${appStates[TransType]}`)){cachedTransactionQueries[appStates[TransType]]=global(`ALDCACHE${appStates[TransType]}`),cachedTransCount[appStates[TransType]]=cachedTransactionQueries[appStates[TransType]].split("||").length,queryLog=cachedTransactionQueries[appStates[TransType]],cachedTransObjectString[appStates[TransType]]=GetProductDetails(queryLog),cachedTransObjectJson[appStates[currentAppStateIndex]]=JSON.parse(cachedTransObjectString[appStates[TransType]]);var total=/TOTAL:\sTZS\s(\d+,{0,1}\d+,{0,1}\d+,{0,1}\d+)/gm.exec(cachedTransObjectJson[appStates[currentAppStateIndex]].finalResponseMsg);null!=total&&(cachedTransCashTotal[appStates[TransType]]=eval(total.length>0?eval(total[1].replaceAll(",","")):0))}else cachedTransCount[appStates[TransType]]=0,cachedTransCashTotal[appStates[TransType]]=0;document.querySelector("#cachedTrans>div>.part1").innerHTML=cachedTransCount[appStates[0]],document.querySelector("#cachedTrans>div>.part2").innerHTML=cachedTransCashTotal[appStates[0]],document.querySelectorAll(".hiddenpreview").forEach((e=>{e.classList.remove("hiddenpreview"),e.classList.add("shownpreview")}))}catch(e){show(`Error Loading CachedTrans loadCachedTrans(): ${e.stack}`)}}catch(e){show("error loadCachedTrans::"+e.stack)}clearvalues()}function createList(e=names,t=""){try{results.innerHTML="",e.forEach((e=>{results.innerHTML+=e})),document.querySelectorAll("input").forEach((e=>{e.addEventListener("click",(()=>e.value=""))})),document.querySelectorAll("a.product").forEach((e=>{e.addEventListener("click",(e=>{document.querySelector("#myinputbar").classList.remove("hyper")})),e.addEventListener("focus",(e=>{var t=e.srcElement.getAttribute("name");t!=oldFocusedProduct&&document.querySelector("li.product[name='"+oldFocusedProduct+"']")&&document.querySelector("li.product[name='"+oldFocusedProduct+"']").classList.remove("hovering"),(currentFocusedProduct=document.querySelector("li.product[name='"+t+"']"))&&(document.querySelector("li.product.hovering")&&document.querySelector("li.product.hovering").classList.remove("hovering"),document.querySelector("#myinputbar").classList.remove("hyper"),closeFilterDialog(),currentFocusedProduct.classList.add("hovering"),document.querySelector("li.product[name='"+t+"']>a>input").select()),currentFocusedProduct=t,oldFocusedProduct=t,document.querySelectorAll("a").forEach((e=>{e.classList.remove("pressed")})),e.srcElement.classList.add("pressed"),document.querySelector("#myinputbar").classList.add("hyper");const a=e.srcElement.getAttribute("name"),r=(appStates[currentAppStateIndex],document.querySelector(".product.pressed > input:not(.hidden)"));isMultTextArray[a]=r?r.value:"";const n=isMultTextArray[a]||"1",s=a+appStateMarks[currentAppStateIndex]+n;document.getElementById("submitbutton").innerHTML=s,document.getElementById("submitbutton").href="/"+s,r.focus()}))})),document.querySelectorAll(".product > input").forEach((e=>{e.classList.remove("pressed"),e.addEventListener("keyup",(function(e){e.key.toString(),e.srcElement.getAttribute("name");"Enter"===e.key&&(document.getElementById("submitbutton").click(),document.getElementById("warehouseName").focus())}))}))}catch(e){show(e.stack+" -- error creating list")}}function createProductsView(){const e=appStates[currentAppStateIndex];if(settingsObj){switch(e){case"wholesale_sale":case"wholesale_purchase":case"wholesale_purchase_delivered":case"stocktake":products_jsonString=JSON.parse(settingsObj.settings.alradaitemnames).slice(1),products_jsonString.sort(((e,t)=>/Pesa/g.test(t.OfficialName)?-1:/Crate Peke|Fungu la Chupa|Pesa/g.test(e.OfficialName)||e.category_breakdown<t.category_breakdown?1:e.category_breakdown>t.category_breakdown?-1:t.laststocktakedate-e.laststocktakedate?t.laststocktakedate-e.laststocktakedate:t.theysaylaststocktakeamt-e.theysaylaststocktakeamt?t.theysaylaststocktakeamt-e.theysaylaststocktakeamt:0)),names=products_jsonString.map((t=>{const a=t.OfficialName,r=getCategorySign(t.category_breakdown),n=t.category_breakdown.split("_").join(" "),s=formatPrice(t.w_price_a,t.w_purchase_a);return createProductLi(a,a.replaceAll(" ","_"),n,s,r,e)}));break;case"sent2_bank":suppliers_jsonString=JSON.parse(settingsObj.settings.suppliers).slice(1),names=suppliers_jsonString.map((t=>{const a=t.officialname,r=t.contactname;return createProductLi(a,a.replaceAll(" ","_"),"","","",e,r)}))}hideExistingInputs(),createList(names,prefix),addInputEventListeners()}}function getCategorySign(e){let t="";return/alcohol/.test(e)&&(t="🔞"),/beer/.test(e)&&(t="   🍺 "+t),/liquar/.test(e)&&(t="  🥃  "+t),t}function formatPrice(e,t){return"wholesale_sale"==appStates[currentAppStateIndex]||"stocktake"==appStates[currentAppStateIndex]?e.toString().replace(/\d{1,3}(?=(\d{3})+(?!\d))/g,"$&,"):t.toString().replace(/\d{1,3}(?=(\d{3})+(?!\d))/g,"$&,")}function createProductLi(e,t,a,r,n,s,c=""){const o="wholesale_sale"===s?"inputnumber":"inputremaining",i="sent2_bank"===s?c:r+" tsh",l=`input${o}_${s}_${t}`;return`<li class="product active ${a}" data-category="${a}" name="${t}">\n            <a class="product ${a}" href="#" name="${t}">\n              ${productNameWithContact(e,c)}\n              <span>${i}<span class="classification">${n}</span></span>\n              <input type="number" id="${l}" name="${t}" placeholder="#️⃣ Kiasi" value="" class="${o}" onClick="event.target.parentNode.dispatchEvent(new Event('focus'))" />\n            </a>\n          </li>`}function productNameWithContact(e,t){return t?`${e} -${t}`:e}function hideExistingInputs(){document.querySelector("a > input")?.classList.add("hidden")}function addInputEventListeners(){document.querySelectorAll("#myinputbar> input").forEach((e=>{e.addEventListener("focus",(function(e){document.querySelector("#myinputbar").classList.add("hyper")})),e.addEventListener("focusout",(function(e){document.querySelector("#myinputbar").classList.remove("hyper")}))}))}function sendCachedTrans(e){try{if(cachedTransCount[t]="Tunatuma Repoti",cachedTransCashTotal[t]="Subiri ..",document.querySelector("#btnSend2Cache").classList.add("disabled"),document.querySelector("#btnSend2Cache").disabled=!0,document.querySelector("#cachedTrans>div>.part1").innerHTML=cachedTransCount[t],document.querySelector("#cachedTrans>div>.part2").innerHTML=cachedTransCashTotal[t],-1==window.location.href.indexOf("http://127.0.0.1:3000/")&&"sending"==global(`ALDSNDSTATUS${t}`))return void show("Bado Repoti ya Mwisho Haijakamilika kwenda",!0);var t=appStates[currentAppStateIndex];if(0==cachedTransactionQueries[t])return;if(hideLoadingScreen(),!JSON.parse(cachedTransObjectString[t]).json_response)return show("Hujafadhi chochote...",!1),0;var a=JSON.parse(cachedTransObjectString[t]).json_response;const e="https://script.google.com/macros/s/AKfycbyoyton0-dUELgipTaCiyvqoksDCkbL0Nrj82Ouj05iBoNwN9ydVld0cjpnYBqzuIXW/exec",r=(new Date).getTime(),n=a.map((e=>[e.transDate,staffName.slice(0,2)+" "+e.transMsg.replace(/\d{1,2}\/\d{1,2}\/\d{4}\s\d{1,2}:\d{1,2}\s/,""),e.transWarehouseName])),s=JSON.stringify({usr:staffName,data:n,time:r,cmd:"add_transaction"});-1==window.location.href.indexOf("http://127.0.0.1:3000/")&&setGlobal(`ALDSNDSTATUS${t}`,"sending");const c=document.querySelector("#clipboard");c.value=s,c.focus(),navigator.clipboard.writeText(c.value).then((function(e){showLoadingScreen("Tunatuma Repoti...","<h1>♻️</h1>","<span class='tunatumaMsg'>"+JSON.parse(cachedTransObjectString[t]).finalResponseMsg.replaceAll(/(\=\s\d+\,{0,}\d+)(\s)/gm,"$1<br/>").replaceAll(/\@\d+\.{0,1}\d{0,}/gm,"").replaceAll(/(TOTAL.*)/gm,"<br/>$1")+"</span>")})),fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:s}).then((e=>(responseClone=e.clone(),e.ok?e.json():e.text().then((e=>{throw new Error("ErrServer response: "+e,!1,!0)}))))).then((e=>{clearvalues(),cachedTransObjectString[t]="",cachedTransactionQueries[t]="",cachedTransCount[t]=0,cachedTransCashTotal[t]=0;try{document.querySelector("#btnSend2Cache").classList.remove("disabled"),document.querySelector("#btnSend2Cache").disabled=!1,document.querySelector("#cachedTrans>div>.part1").innerHTML=cachedTransCount[t],document.querySelector("#cachedTrans>div>.part2").innerHTML=cachedTransCashTotal[t]}catch(e){}-1==window.location.href.indexOf("http://127.0.0.1:3000/")&&(setGlobal(`ALDCACHE${t}`,cachedTransactionQueries[t]),setGlobal(`ALDSNDSTATUS${t}`,"ready"));try{responseClone.text().then((e=>{show("txtServer responded: "+e,!1,!0,!1)}))}catch(e){show(e.stack+"-there was an error")}show("Repoti Imetumwa...",!1),goto("command||beep"),createProductsView()})).catch((e=>{e.message.includes("Failed to fetch")?(-1==window.location.href.indexOf("http://127.0.0.1:3000/")&&setGlobal(`ALDSNDSTATUS${t}`,"sending_failed"),show("Tatizo la network. Ebu cheki internet alafu Jaribu Tena. "+e.stack)):responseClone.text().then((e=>{show("Server responded: "+e,!1,!0,!1)}))})),setTimeout((function(){hideLoadingScreen()}),4e3)}catch(e){show(e.stack+"-an error")}}function handleCachedTransEvent(event){if(event&&event.target.id){var target=event.target,json_response=JSON.parse(cachedTransObjectString[appStates[currentAppStateIndex]]).json_response,id=eval(/_(\d+)/g.exec(target.id)[1]);if("sent2_bank"==json_response[id].transType)var old_mulitplier=json_response[id].priceTotal;else var old_mulitplier=json_response[id].multiplier<1?"."+json_response[id].transCarton*json_response[id].multiplier:json_response[id].multiplier;editingquery=`${json_response[id].transMsg}`;var ConfirmDialogContent=`<div id="myModal">\n    <div class="editvalues showonlyadmin">\n    <a href="#" class="notyet" id="edit_date">${json_response[id].transDate}</a>\n    <a href="#" class="notyet" id="edit_shopname" >${json_response[id].transWarehouseName}</a>\n    <a href="#" class="" id="edit_drinkname" onclick="reCreateProductSelectDialog()"  placeholder="" value="${json_response[id].rawproductname}">${json_response[id].rawproductname}</a>\n    <span id="edit_multipliersign">${appStateMarks[currentAppStateIndex]}</span>\n    <input type="text" id="edit_multiplier"  placeholder="${old_mulitplier}" value="${old_mulitplier}" />\n        </div>\n    <div class="buttonholder" style="display:flex">\n\n    <button onclick="confirmFormYes()">🚮 ONDOA KABISA</button>`;"wholesale_sale"==appStates[currentAppStateIndex]&&(ConfirmDialogContent+="<button onclick=\"confirmFormEdit('isLoan')\">⚠️ DENI</button>"),ConfirmDialogContent+='<button onclick="confirmFormEdit()">🛠️ REKEBISHA MPYA</button>\n    <button onclick="confirmFormNo()">👌🏽 USIBADILISHE</button></div>\n  </div>\n</div>',confirmFormNo=function(){hideLoadingScreen()},confirmFormEdit=function(edit_mode="default"){var mult_sign=appStateMarks[currentAppStateIndex];"isLoan"==edit_mode&&(mult_sign="-");var newquery=`${document.querySelector("#edit_date").value} (${document.querySelector("#edit_shopname").value})${document.querySelector("#edit_drinkname").innerHTML}${mult_sign}${document.querySelector("#edit_multiplier").value}`,oldquery=cachedTransactionQueries[appStates[currentAppStateIndex]].replaceAll("(plus)","+");queryLog=oldquery.replace(editingquery,newquery).replaceAll(/\.(\d+)$/gm,"p$1").trim(),productdetails_string=GetProductDetails(queryLog),cachedTransObjectString[appStates[currentAppStateIndex]]=productdetails_string,cachedTransObjectJson[appStates[currentAppStateIndex]]=JSON.parse(productdetails_string),json_response=cachedTransObjectJson[appStates[currentAppStateIndex]].json_response,cachedTransactionQueries[appStates[currentAppStateIndex]]=cachedTransObjectJson[appStates[currentAppStateIndex]].finalQuery,cachedTransCashTotal[appStates[currentAppStateIndex]]=eval(cachedTransObjectJson[appStates[currentAppStateIndex]].finalResponseTotal);var result_display=cachedTransObjectJson[appStates[currentAppStateIndex]].finalResponseMsg;cachedTempTrans2Process[appStates[currentAppStateIndex]]&&cachedTempTrans2Process[appStates[currentAppStateIndex]].length<=0&&document.querySelectorAll(".disabled").forEach((e=>{e.disabled=!1,e.classList.remove("disabled"),e.classList.add("enabled")})),cachedTransactionQueries[appStates[currentAppStateIndex]]&&cachedTransactionQueries[appStates[currentAppStateIndex]].length<=0&&document.querySelectorAll(".hiddenpreview").forEach((e=>{e.classList.remove("hiddenpreview"),e.classList.add("shownpreview")})),document.querySelector("#cachedTrans>div>.part1").innerHTML=cachedTransCount[appStates[currentAppStateIndex]],document.querySelector("#cachedTrans>div>.part2").innerHTML=cachedTransCashTotal[appStates[currentAppStateIndex]].toLocaleString("en-US").replace(/\.00/g,""),-1==window.location.href.indexOf("http://127.0.0.1:3000/")&&setGlobal(`ALDCACHE${appStates[currentAppStateIndex]}`,cachedTransactionQueries[appStates[currentAppStateIndex]]),reCreateCacheCleanupForm()},showLoadingScreen(`🗑️ FUTA: <sub>${json_response[id].priceTotal.toLocaleString("en-US").replace(/\.00/g,"")}`,"",ConfirmDialogContent),confirmFormYes=function(){delete json_response[id],queryLog="";for(const e in json_response)queryLog+=`${json_response[e].transMsg},`;productdetails_string=GetProductDetails(queryLog),cachedTransObjectString[appStates[currentAppStateIndex]]=productdetails_string,cachedTransObjectJson[appStates[currentAppStateIndex]]=JSON.parse(productdetails_string),json_response=cachedTransObjectJson[appStates[currentAppStateIndex]].json_response,cachedTransactionQueries[appStates[currentAppStateIndex]]=cachedTransObjectJson[appStates[currentAppStateIndex]].finalQuery,cachedTransCashTotal[appStates[currentAppStateIndex]]=eval(cachedTransObjectJson[appStates[currentAppStateIndex]].finalResponseTotal);var result_display=cachedTransObjectJson[appStates[currentAppStateIndex]].finalResponseMsg;cachedTempTrans2Process[appStates[currentAppStateIndex]]&&cachedTempTrans2Process[appStates[currentAppStateIndex]].length<=0&&document.querySelectorAll(".disabled").forEach((e=>{e.disabled=!1,e.classList.remove("disabled"),e.classList.add("enabled")})),cachedTransactionQueries[appStates[currentAppStateIndex]]&&cachedTransactionQueries[appStates[currentAppStateIndex]].length<=0&&document.querySelectorAll(".hiddenpreview").forEach((e=>{e.classList.remove("hiddenpreview"),e.classList.add("shownpreview")})),document.querySelector("#cachedTrans>div>.part1").innerHTML=cachedTransCount[appStates[currentAppStateIndex]],document.querySelector("#cachedTrans>div>.part2").innerHTML=cachedTransCashTotal[appStates[currentAppStateIndex]].toLocaleString("en-US").replace(/\.00/g,""),-1==window.location.href.indexOf("http://127.0.0.1:3000/")&&setGlobal(`ALDCACHE${appStates[currentAppStateIndex]}`,cachedTransactionQueries[appStates[currentAppStateIndex]]),reCreateCacheCleanupForm()}}}function reCreateProductSelectDialog(e=""){var t='<h2 style="margin-bottom:10px">Chagua Product</h2><ul id="results" class="products selectproduct">';for(const e in names)t+=names[e];document.querySelector("#filter-dialog").innerHTML=t,document.querySelector("#filter-dialog").classList.remove("hidden"),document.querySelectorAll("#results.selectproduct>li>a").forEach((e=>{e.addEventListener("click",(()=>{var t=e.name.replace("_"," ");document.querySelector("#edit_drinkname").innerHTML=t,document.querySelector("#filter-dialog").classList.add("hidden")}))}))}function showLoadingScreen(e,t,a){hideLoadingScreen(),document.getElementById("news_display").style.pointerEvents="none",document.getElementById("mywebview2").style.pointerEvents="none",document.getElementById("loading-title").innerHTML=e,document.getElementById("loading-subtitle").innerHTML=t,document.getElementById("loading-text").innerHTML=a,document.getElementById("loading-screen").classList.remove("hidden")}function hideLoadingScreen(){document.getElementById("news_display").style.pointerEvents="",document.getElementById("mywebview2").style.pointerEvents="",document.getElementById("loading-title").innerHTML="",document.getElementById("loading-subtitle").innerHTML="",document.querySelector("#loading-screen .loading-content .buttonholder").innerHTML="",document.getElementById("loading-text").innerHTML="...",document.getElementById("loading-screen").classList.add("hidden")}function reCreateCacheCleanupForm(){document.getElementById("news_display").style.pointerEvents="",document.getElementById("mywebview2").style.pointerEvents="",document.getElementById("loading-screen").classList.add("hidden");var e='<code><ul id="entries">';for(const r in cachedTransObjectJson[appStates[currentAppStateIndex]].json_response){var t=cachedTransObjectJson[appStates[currentAppStateIndex]].json_response[r],a=/((\-\-|\+\+|#|=|\+|ӿ|-|\$)\d{0,}[p]{0,1}\d+)$/g.exec(t.transMsg)[1];e+=`<li id="confirmCachedEntry" name="confirmCachedEntry_${r}" >\n       <div class="flex-column" >\n        <span class="flex-row"><a href="#" id="confirmCachedEntry" name="TransactionEditDate_${r}" title="${t.transDate}" onClick="handleTransEvent(event)">${t.transDate}</a>\n        <a href="#" id="confirmCachedEntry" type="Jina La Shop" name="TransactionEditWarehouse_${r}" title="${t.transWarehouseName}" onClick="handleTransEvent(event)">(${t.transWarehouseName})</a></span>\n        <div class="flex-row"><div class="flex-row">\n        <a href="#" id="confirmCachedEntry" name="TransactionEditDrinkName_${r}" title="${t.rawproductname}" onClick="handleTransEvent(event)">${t.rawproductname}</a>\n        <a href="#" id="confirmCachedEntry" name="TransactionEditUnitPrice_${r}" rel="@" type="Kiasi" title="${t.unitprice}" onClick="handleTransEvent(event)">@${t.unitprice}</a>\n        <a href="#" id="confirmCachedEntry" name="TransactionEditMultiplier_${r}" title="${a.match(/\d+\.{0,1}\d{0,}/g)[0]}" onClick="handleTransEvent(event)" type="" rel="${appStateMarks[currentAppStateIndex]}">${a}=${t.priceTotal}</a></div>\n       <button id="confirmCachedEntry" name="TransactionDelete_${r}" onClick="handleTransEvent(event)">❌</button></div>\n       </div></li>`}e+="</ul></code>",document.getElementById("loading-text").innerHTML=e,document.getElementById("loading-screen").classList.remove("hidden"),document.querySelector("#loading-screen .loading-content .buttonholder").innerHTML="<button onClick=\"hideLoadingScreen();clearvalues()\" >Subiri</button><button onclick='sendCachedTrans()'>Tuma Repoti</button><button id='btnClose' onClick='hideLoadingScreen();clearvalues()'> X </button>",document.getElementById("loading-title").innerHTML=`Angalia vizuri na Sahihisha ripoti,<br/><sub>kabla ya kutuma. ${JSON.parse(cachedTransObjectString[appStates[currentAppStateIndex]]).finalResponseTotal.toLocaleString("en-US").replace(/\.00/g,"")}</sub>`}function initializeListeners(){document.querySelector("#resultpad").addEventListener("click",(e=>{try{""!=document.querySelector("#result_display").innerHTML&&document.querySelector("#filter-dialog").classList.contains("hidden"),document.querySelector("a.product.pressed")&&document.querySelector("a.product.pressed").parentNode.classList.remove("hovering"),hideLoadingScreen(),document.querySelector("#myinputbar").classList.remove("hyper")}catch(e){show("error loadCachedTrans::"+e.stack)}})),document.querySelector("#cachedTrans").addEventListener("click",(e=>{if(!JSON.parse(cachedTransObjectString[appStates[currentAppStateIndex]]).json_response)return show("Huja fadhi chochote...",!0),0;reCreateCacheCleanupForm()})),document.querySelector("a.submitbutton").addEventListener("click",(e=>{e.preventDefault();try{document.querySelector("a.product.pressed").parentNode.classList.remove("hovering")}catch(e){}if(currentFocusedProduct)try{if("MATUMIZI_MENGINE"==currentFocusedProduct){var t=currentFocusedProduct;if(extraTransDetails=prompt("Elezeya Malipo::",""),null==extraTransDetails||""==extraTransDetails)throw new Error("Lazima Uingize Aina Ya Malipo ");var a=(currentFocusedProduct=`${currentFocusedProduct}::${extraTransDetails.trim()}`)+"="+document.querySelector(`a[name="${t}"]>input`).value}else a=currentFocusedProduct.replaceAll("_"," ")+appStateMarks[currentAppStateIndex]+document.querySelector(`a[name="${currentFocusedProduct}"]>input`).value;if(/\d+$/.test(a)||("stocktake"==appStates[currentAppStateIndex]?a+="0":/Kony|vant|Valu|Hanson/.test(a)?a+=".1":a+="1"),"stocktake"!=appStates[currentAppStateIndex]){var r=/\d+\.\d+$/.test(a)?/(\d+)\.\d+$/.exec(a)[1]:"",n=/\.\d+$/.test(a)?/\.(\d+)$/.exec(a)[1]:"";if(""!=r&&""!=n){var s=new RegExp("[++|-|+|#|ӿ]"+r+"."+n,"g"),c=new RegExp("([++|-|+|#|ӿ])"+r+"."+n,"g").exec(a),o=a.replaceAll(s,"");a=o+c[1]+r+","+o+c[1]+"."+n}}if(a=`(${warehouseName.toLowerCase()})${a}`,date=new Date,a=(mydate.replaceAll("&nbsp;","").trim()+` ${date.getHours()}:${date.getMinutes()} `+a.replaceAll(/\.(\d+)$/gm,"p$1")).trim(),queryLog="stocktake"==appStates[currentAppStateIndex]?queryLog.replaceAll(a+",","").concat(`,${a}`):queryLog.concat(`,${a},`.replace("undefined","").replace(/\n/,"").trim()),productdetails_string=GetProductDetails(queryLog.replace(/^,/,"")),productdetails_json=JSON.parse(productdetails_string),queryLog=productdetails_json.finalQuery,document.querySelector("#result_display>ul").innerHTML=productdetails_json.finalResponseMsg.replaceAll("\n","<br/>"),document.querySelectorAll(".disabled").forEach((e=>{e.disabled=!1,e.classList.remove("disabled"),e.classList.add("enabled")})),document.querySelector("#submitbuttonholder").classList.remove("hyper"),document.querySelector("#myinputbar").classList.remove("hyper"),"stocktake"==appStates[currentAppStateIndex]){var i="li.product[name='"+e.srcElement.pathname.replace("/","")+"']";document.querySelector(i).classList.add("hidden")}document.getElementById("warehouseName").focus()}catch(e){show(e.stack+" -there was an error"+e)}})),document.getElementById("search").addEventListener("input",(function(){var e=this.value;createList(names.filter((function(t){return t.toLowerCase().includes(e.toLowerCase())})),prefix),writtenInSearch=this.value})),document.querySelector("#appState").addEventListener("click",(e=>(clearvalues(),document.querySelector("#choose-mode").classList.remove("hidden"),document.querySelectorAll("button").forEach((e=>{e.classList.remove("pressed")})),!1))),document.querySelector("#inputnumber_change").addEventListener("change",(e=>{var cashcollected=eval(e.srcElement.value),total=/TOTAL:\sTZS\s(\d+,{0,1}\d+,{0,1}\d+,{0,1}\d+)/gm.exec(finalResponseMsg);if(null!=total){total=total.length>0?total[1].replaceAll(",",""):0;var change=cashcollected-total,currentresults=document.querySelector("#result_display").innerHTML.replace(/<br>----------<br>(.*)/gm,"");currentresults=currentresults+"<br/>----------<br/>PAID: "+cashcollected.toString().replace(/\d{1,3}(?=(\d{3})+(?!\d))/g,"$&,")+"<br/>----------<br/>CHANGE: "+change.toString().replace(/\d{1,3}(?=(\d{3})+(?!\d))/g,"$&,")+"<end/>",document.querySelector("#result_display").innerHTML=currentresults}})),document.querySelector("#search").addEventListener("focus",(e=>{e.srcElement.value=""})),document.querySelector("#selectmode").addEventListener("click",(e=>{document.querySelector("#choose-mode").classList.add("hidden"),document.querySelector("#querydialog").classList.remove("hidden"),document.querySelector("#querydialog>input").focus()})),document.querySelector("#querydialog>input").addEventListener("keyup",(function(e){e.key.toString();if("Enter"===e.key){var t=document.querySelector("#query").value;if(""==t)return 0;if("stocktake"!=appStates[currentAppStateIndex]){var a=/\d+\.\d+$/.test(t)?/(\d+)\.\d+$/.exec(t)[1]:"",r=/\.\d+$/.test(t)?/\.(\d+)$/.exec(t)[1]:"";if(""!=a&&""!=r){var n=new RegExp("[++|-|+|#|ӿ]"+a+"."+r,"g"),s=new RegExp("([++|-|+|#|ӿ])"+a+"."+r,"g").exec(t),c=t.replaceAll(n,"");t=c+s[1]+a+","+c+s[1]+"."+r}}t=`(${warehouseName.toLowerCase()})${t}`,date=new Date,t=(mydate.replaceAll("&nbsp;","").trim()+` ${date.getHours()}:${date.getMinutes()} `+t.replaceAll(/\.(\d+)$/gm,"p$1")).trim(),queryLog="stocktake"==appStates[currentAppStateIndex]?queryLog.replaceAll(t+",","").concat(`,${t}`):queryLog.concat(`,${t},`.replace("undefined","").replace(/\n/,"").trim()),productdetails_json=JSON.parse(GetProductDetails(queryLog.replace(/^,/,""))),queryLog=productdetails_json.finalQuery,document.querySelector("#result_display>ul").innerHTML=productdetails_json.finalResponseMsg.replaceAll("\n","<br/>"),document.querySelectorAll(".disabled").forEach((e=>{e.disabled=!1,e.classList.remove("disabled"),e.classList.add("enabled")})),document.querySelector("#submitbuttonholder").classList.remove("hyper"),document.querySelector("#myinputbar").classList.remove("hyper"),document.querySelector("#querydialog").classList.add("hidden"),document.getElementById("warehouseName").focus()}}))}function chooseToAddTransactionToCache(e){addTransactionToCache(e),reCreateCacheCleanupForm()}function addTransactionToCache(event){if("Subiri .."==cachedTransCashTotal[appStates[currentAppStateIndex]])return;let target=event.target,currentQuery=productdetails_json.finalQuery;if("stocktake"==appStates[currentAppStateIndex]){var isclosing=prompt(`Bonyeza ' OKAY ' KAMA NI StockTake yakuFUNGA (CLOSE) MAHESABU ya\n${mydate}\nBonyeza ' CANCEL ' kama ni yakuFUNGUA (OPEN) MAHESABU ${mydate}!`,mydate);if(null==isclosing){var newdatetext=mydate.trim();currentQuery=currentQuery.replaceAll(/(\d+\/\d+[\/\d+]{0,5})/gm,`${newdatetext}`)}else if(isclosing.trim().toLocaleLowerCase().match(/\d{1,2}\/\d{1,2}\/.*/gm)){var newdatetext=isclosing;currentQuery=currentQuery.replaceAll(/(\d+\/\d+[\/\d+]{0,5})/gm,`${newdatetext}`)}else if("ndio"==isclosing.toLowerCase()){if(/(\d+\/\d+)[(\/\d+)]{0,5}/gm.exec(currentQuery))var datetext=/(\d+\/\d+)[(\/\d+)]{0,5}/gm.exec(currentQuery)[0].trim();var dd=eval(/(\d+)\/\d+[(\/\d+)]{0,5}/gm.exec(datetext)[1])+1;currentQuery=currentQuery.replaceAll(/\d+(\/\d+[(\/\d+)]{0,5})/gm,`${dd}$1`)}}if(null==cachedTransactionQueries[appStates[currentAppStateIndex]])cachedTransactionQueries[appStates[currentAppStateIndex]]=currentQuery,cachedTransCount[appStates[currentAppStateIndex]]=1,cachedTransObjectJson[appStates[currentAppStateIndex]]=productdetails_json,cachedTransObjectString[appStates[currentAppStateIndex]]=productdetails_string,cachedTransCashTotal[appStates[currentAppStateIndex]]=/TOTAL:\sTZS\s(\d+,{0,1}\d+,{0,1}\d+,{0,1}\d+)/gm.exec(productdetails_json.finalResponseMsg),cachedTransCashTotal[appStates[currentAppStateIndex]]?cachedTransCashTotal[appStates[currentAppStateIndex]]=cachedTransCashTotal[appStates[currentAppStateIndex]].length>0?eval(cachedTransCashTotal[appStates[currentAppStateIndex]][1].replaceAll(",","")):0:cachedTransCashTotal[appStates[currentAppStateIndex]]=0;else{cachedTransactionQueries[appStates[currentAppStateIndex]]+=",||"+currentQuery,cachedTransCount[appStates[currentAppStateIndex]]=cachedTransactionQueries[appStates[currentAppStateIndex]].split("||").length,cachedTransObjectString[appStates[currentAppStateIndex]]=GetProductDetails(cachedTransactionQueries[appStates[currentAppStateIndex]]),cachedTransObjectJson[appStates[currentAppStateIndex]]=JSON.parse(cachedTransObjectString[appStates[currentAppStateIndex]]);var total=/TOTAL:\sTZS\s(\d+,{0,1}\d+,{0,1}\d+,{0,1}\d+)/gm.exec(cachedTransObjectJson[appStates[currentAppStateIndex]].finalResponseMsg);null!=total&&(cachedTransCashTotal[appStates[currentAppStateIndex]]=total.length>0?eval(total[1].replaceAll(",","")):0)}if(document.querySelector("#cachedTrans>div>.part1").innerHTML=cachedTransCount[appStates[currentAppStateIndex]],document.querySelector("#cachedTrans>div>.part2").innerHTML=cachedTransCashTotal[appStates[currentAppStateIndex]],-1==window.location.href.indexOf("http://127.0.0.1:3000/"))for(const e in cachedTransactionQueries){var transaction=cachedTransactionQueries[e];setGlobal(`ALDCACHE${e}`,transaction)}document.querySelectorAll(".hiddenpreview").forEach((e=>{e.classList.remove("hiddenpreview"),e.classList.add("shownpreview")})),clearvalues()}function createFilterDialogContent(){const e={},t={};products_jsonString.forEach((a=>{const r=a.category_breakdown.split("_")[2].toLowerCase();categories[r]||(categories[r]=[]),categories[r][a.OfficialName]||(categories[r][a.OfficialName]=[]),categories[r][a.OfficialName].push({name:a.OfficialName,classes:r.split(".").map((e=>e.toLowerCase())).join(" ")});const n=a.category_breakdown.split("_")[3];e[n]||(e[n]=[]),e[n].push(a);const s=a.category_breakdown.split("_")[4]?a.category_breakdown.split("_")[4]:0;t[s]||(t[s]=[]),t[s].push(a)}));const a=document.createElement("div");a.innerHTML="\n    <h3>Vichujio:Aina ya kinywaji</h3>\n        <ul>";for(const e in categories)a.innerHTML+=`\n      <li onClick="handleFilterDialogFilterSelection(event)">\n        <label for="${e}">${e}</label>\n        <input type="checkbox" id="category_${e}" >\n      </li>`;return a.innerHTML+='\n      </ul>\n        <h4>VipaoMbele NPS</h4>\n  <input type="range" min="0" max="10" id="financial_nps" value="0">\n      ',a.innerHTML+='\n      <h4>Kasi ya kukimbia</h4>\n  <input type="range" id="speed" min="0" max="5"> </div>\n     ',a.innerHTML+="\n    ",a.innerHTML+='<button id="close-dialog" onClick="closeFilterDialog()"> X </button>',a}function getRunningSpeedRange(e){return e<=5?"Slow":e<=10?"Medium":"Fast"}function showFilterDialog(){const e=document.getElementById("filter-dialog");0===e.children.length&&(e.appendChild(createFilterDialogContent()),document.querySelectorAll("li.product.active").forEach((e=>{e.classList.remove("active")}))),e.classList.remove("hidden")}function handleTransEvent(event){var target=event.target,action=target.name.split("_"),family=target.id;if(id=eval(action[1]),action=action[0],oldval=target.title,type=target.type,sign=target.rel,dialog=document.querySelector("#filter-dialog"),content="","confirmCachedEntry"==family)var json_transactions=JSON.parse(cachedTransObjectString[appStates[currentAppStateIndex]]);else if("confirmTransactionEntry"==family)var json_transactions=productdetails_json;var oldquery=json_transactions.finalQuery,editing=`${json_transactions.json_response[id].transMsg}`;switch(action){case"TransactionEditDrinkName":content='<h2 style="margin-bottom:10px">Chagua Product</h2><ul id="results" class="products selectproduct">';for(const e in names)content+=names[e];dialog.innerHTML=content,document.querySelectorAll("#results.selectproduct>li>a").forEach((el=>{el.addEventListener("click",(()=>{var newval=el.name.replaceAll("_"," "),newediting=editing.replace(oldval,newval).replace(/@\d+\.{0,1}\d{0,}/,""),newquery=oldquery.replace(editing,newediting),newjson_transactions=JSON.parse(GetProductDetails(newquery));"confirmCachedEntry"==family?(cachedTransObjectString[appStates[currentAppStateIndex]]=JSON.stringify(newjson_transactions),cachedTransactionQueries[appStates[currentAppStateIndex]]=newjson_transactions.finalQuery,cachedTransCashTotal[appStates[currentAppStateIndex]]=eval(newjson_transactions.finalResponseTotal),cachedTempTrans2Process[appStates[currentAppStateIndex]]&&cachedTempTrans2Process[appStates[currentAppStateIndex]].length<=0&&document.querySelectorAll(".disabled").forEach((e=>{e.disabled=!1,e.classList.remove("disabled"),e.classList.add("enabled")})),cachedTransactionQueries[appStates[currentAppStateIndex]]&&cachedTransactionQueries[appStates[currentAppStateIndex]].length<=0&&document.querySelectorAll(".hiddenpreview").forEach((e=>{e.classList.remove("hiddenpreview"),e.classList.add("shownpreview")})),document.querySelector("#cachedTrans>div>.part1").innerHTML=cachedTransCount[appStates[currentAppStateIndex]],document.querySelector("#cachedTrans>div>.part2").innerHTML=cachedTransCashTotal[appStates[currentAppStateIndex]].toLocaleString("en-US").replace(/\.00/g,""),-1==window.location.href.indexOf("http://127.0.0.1:3000/")&&setGlobal(`ALDCACHE${appStates[currentAppStateIndex]}`,cachedTransactionQueries[appStates[currentAppStateIndex]]),reCreateCacheCleanupForm()):"confirmTransactionEntry"==family&&(productdetails_json=newjson_transactions,document.querySelector("#result_display>ul").innerHTML=productdetails_json.finalResponseMsg.replaceAll("\n","<br/>"),document.querySelectorAll(".disabled").forEach((e=>{e.disabled=!1,e.classList.remove("disabled"),e.classList.add("enabled")})),document.querySelector("#submitbuttonholder").classList.remove("hyper"),document.querySelector("#myinputbar").classList.remove("hyper"),queryLog=productdetails_json.finalQuery),closeFilterDialog()}))})),showFilterDialog();break;case"TransactionEditMultiplier":case"TransactionEditUnitPrice":case"TransactionEditWarehouse":content=`<h3>Ingiza ${type} (${oldval}) </h3><div><input name="" placeholder="${oldval}" type="${"TransactionEditWarehouse"==action?"text":"number"}  " onkeyup="confirmFormEdit(event)"/></div>`,dialog.innerHTML=content,confirmFormEdit=function(e){if("Enter"==e.key){var newval=document.querySelector("#filter-dialog>div>input").value,newediting=editing.replace(sign+oldval,sign+newval),newquery=oldquery.replace(editing,newediting),newjson_transactions=JSON.parse(GetProductDetails(newquery));"confirmCachedEntry"==family?(cachedTransObjectJson[appStates[currentAppStateIndex]]=newjson_transactions,cachedTransObjectString[appStates[currentAppStateIndex]]=JSON.stringify(newjson_transactions),cachedTransactionQueries[appStates[currentAppStateIndex]]=newjson_transactions.finalQuery,cachedTransCashTotal[appStates[currentAppStateIndex]]=eval(newjson_transactions.finalResponseTotal),cachedTempTrans2Process[appStates[currentAppStateIndex]]&&cachedTempTrans2Process[appStates[currentAppStateIndex]].length<=0&&document.querySelectorAll(".disabled").forEach((e=>{e.disabled=!1,e.classList.remove("disabled"),e.classList.add("enabled")})),cachedTransactionQueries[appStates[currentAppStateIndex]]&&cachedTransactionQueries[appStates[currentAppStateIndex]].length<=0&&document.querySelectorAll(".hiddenpreview").forEach((e=>{e.classList.remove("hiddenpreview"),e.classList.add("shownpreview")})),document.querySelector("#cachedTrans>div>.part1").innerHTML=cachedTransCount[appStates[currentAppStateIndex]],document.querySelector("#cachedTrans>div>.part2").innerHTML=cachedTransCashTotal[appStates[currentAppStateIndex]].toLocaleString("en-US").replace(/\.00/g,""),-1==window.location.href.indexOf("http://127.0.0.1:3000/")&&setGlobal(`ALDCACHE${appStates[currentAppStateIndex]}`,cachedTransactionQueries[appStates[currentAppStateIndex]]),closeFilterDialog(),reCreateCacheCleanupForm()):(document.querySelector("#result_display>ul").innerHTML=newjson_transactions.finalResponseMsg.replaceAll("\n","<br/>"),document.querySelectorAll(".disabled").forEach((e=>{e.disabled=!1,e.classList.remove("disabled"),e.classList.add("enabled")})),closeFilterDialog(),document.querySelector("#submitbuttonholder").classList.remove("hyper"),document.querySelector("#myinputbar").classList.remove("hyper"),queryLog=newjson_transactions.finalQuery)}},showFilterDialog();break;case"TransactionDelete":var newquery=oldquery.replace(editing,"").replace(/,$/,"").replace(/^,/,""),newjson_transactions=JSON.parse(GetProductDetails(newquery));productdetails_json=newjson_transactions,"confirmTransactionEntry"==family?(document.querySelector("#result_display>ul").innerHTML=newjson_transactions.finalResponseMsg.replaceAll("\n","<br/>"),document.querySelectorAll(".disabled").forEach((e=>{e.disabled=!1,e.classList.remove("disabled"),e.classList.add("enabled")})),document.querySelector("#submitbuttonholder").classList.remove("hyper"),document.querySelector("#myinputbar").classList.remove("hyper"),queryLog=newjson_transactions.finalQuery):(family="confirmCachedEntry")&&(cachedTransObjectString[appStates[currentAppStateIndex]]=JSON.stringify(newjson_transactions),cachedTransactionQueries[appStates[currentAppStateIndex]]=newjson_transactions.finalQuery,cachedTransCashTotal[appStates[currentAppStateIndex]]=eval(newjson_transactions.finalResponseTotal),cachedTempTrans2Process[appStates[currentAppStateIndex]]&&cachedTempTrans2Process[appStates[currentAppStateIndex]].length<=0&&document.querySelectorAll(".disabled").forEach((e=>{e.disabled=!1,e.classList.remove("disabled"),e.classList.add("enabled")})),cachedTransactionQueries[appStates[currentAppStateIndex]]&&cachedTransactionQueries[appStates[currentAppStateIndex]].length<=0&&document.querySelectorAll(".hiddenpreview").forEach((e=>{e.classList.remove("hiddenpreview"),e.classList.add("shownpreview")})),document.querySelector("#cachedTrans>div>.part1").innerHTML=cachedTransCount[appStates[currentAppStateIndex]],document.querySelector("#cachedTrans>div>.part2").innerHTML=cachedTransCashTotal[appStates[currentAppStateIndex]].toLocaleString("en-US").replace(/\.00/g,""),-1==window.location.href.indexOf("http://127.0.0.1:3000/")&&setGlobal(`ALDCACHE${appStates[currentAppStateIndex]}`,cachedTransactionQueries[appStates[currentAppStateIndex]]),reCreateCacheCleanupForm())}createProductsView();try{document.querySelector("#filter-dialog>div>input").focus()}catch(e){}}function handleFilterDialogFilterSelection(event){let target=event.target;if("li"==target.localName?target=target.firstElementChild:"label"==target.localName&&(target=target.previousElementSibling),"checkbox"!=target.type)return;const filterType=target.id,products=document.querySelectorAll("li.product"),matchingProducts=[];if(filterType.startsWith("category")){const e=filterType.split("_")[1];for(const t of products){let a=t.dataset.category.split(" ")[2];a==e&&(t.classList.contains("active")?(t.classList.remove("active"),target.checked=!1,target.parentNode.classList.remove("selected")):(t.classList.add("active"),target.parentNode.classList.add("selected"),target.checked=!0))}}else if("financial_nps"===filterType){const financialNps=eval(target.value);products.forEach((product=>{const productNps=eval(product.dataset.financialNps);productNps>=financialNps&&matchingProducts.push(product)}))}else if("speed"===filterType){const speed=eval(target.value);products.forEach((product=>{const productSpeed=eval(product.dataset.speed);productSpeed>=speed&&matchingProducts.push(product)}))}closeFilterDialog()}function closeFilterDialog(){document.querySelectorAll(".mypopupdialog").forEach((e=>{e.classList.contains("hidden")||e.classList.add("hidden")}))}function GetProductDetails(query="(hq)Uhai 600ml @400+1",exactdtail="",productsJsonString){var response="",itemcount=1,projectedProfitTotal=0;if(query=query.replace(/\(plus\)/gm,"+").replace(/,$/,"").replaceAll(/\|\|/gm,"").replace(/^,/,"").trim(),void 0===returntype)var returntype="single";let rowmsg="";if(void 0===productsJsonString&&void 0!==settingsObj)var productsJsonString=settingsObj.settings.alradaitemnames;if(null==productsJsonString)throw new Error("productsJsonString is undefined");productsJsonString=productsJsonString.replace(/(?:\[r,p]\n|\[r,p]|\n)/g,"<br>").replace(/\sTZS/g,"");var data=JSON.parse(productsJsonString),headerRow=Object.keys(data[0]),body=data.map((e=>Object.values(e))),dataHeadings=[],dataBody=[];headerRow.forEach((function(e){dataHeadings.push(e)})),body.forEach((function(e){dataBody.push(e)}));var data=dataBody.map(((e,t)=>Object.assign({},...dataHeadings.map(((t,a)=>({[t]:e[a]})))))),asjson=JSON.stringify(data),cleanasjson=asjson.replace(/(?:\r\n|\r|\n)/g,"<br>").replace(/\sTZS/g,"");"string"!=typeof query&&(query=new String(query));var howmanyitems=query.split(new RegExp("(\\s\\&\\s)|,\\s|,|\\sn\\s")).filter((e=>e));let total=0,remain="",wholesale_remain="",retail_remain="",multiplier="",rawproductname="",projectedProfit=0,responseArr=[];howmanyitems.some((function(product,n){var priceTotal=0,netpriceTotal=0,pricetype="",unitprice=/\@\d+/.test(product)?eval(product.match(/\@\d+\.{0,1}\d{0,}/)[0].replace("@","")):"",getendvalue=/(\+{1,2}|\-{1,2}|ӿ|\-|\#)\d{0,}\s{0,1}[r,p]{0,1}\d+\.{0,1}\d{0,}$|[r,p]\d+\.{0,1}\d{0,}$/.test(product)?/(\+{1,2}|\-{1,2}|ӿ|\-|\#)\d{0,}\s{0,1}[r,p]{0,1}\d+$|[r,p]\d+$/.exec(product)[0]:"",myval=getendvalue.match(/[ӿ,\+,\-,\#](\d+)/),whole_multiplier=/[ӿ,\#,\+,\-][r,p]\d+\.{0,1}\d{0,}/.test(product)?0:/[ӿ,\+,\-,\#]\d{0,}p{0,1}\d+$/.test(product)?eval(getendvalue.match(/[ӿ,\+,\-,\#](\d+\.{0,1}\d{0,})/)[1]):1,retail_multiplier=0,transCarton="",getmultipliers=getendvalue.split(" ");if(getmultipliers=getmultipliers[0],/(\d+\/\d+)[(\/\d+)]{0,5}/gm.exec(product))var datetext=/(\d+\/\d+)[(\/\d+)]{0,5}/gm.exec(product)[0].trim();else datetext=ALRADADATE;if(/\d+\/\d+[\/\d+]{0,5}\s(.*)\(/gm.exec(product))var timetext=/\d+\/\d+[\/\d+]{0,5}\s(.*)\(/gm.exec(product)[1].trim();else var timetext="00:00";if(rawproductname=product.replace(/(\d+\/\d+)[(\/\d+)]{0,5}/gm,"").replace(/(\d+ +[r,p] +|^[r,p] +|^\d+ +|^\d+|[ӿ,\+,\$]\d+$)/g,"").replace(/#\d{0,}[r,p]{0,1}\d+|\#\d+$|[\+,\$]\d+|[\-\-,\+\+]/,"").replace(/\#\d+/,"").replace(/@\d+\.{0,1}\d{0,}/g,"").replace(/^t +| +0 +/,"").replace(/^[r,p] +|\s[r,p]\d+\.{0,1}\d{0,}$/g,"").replace(/^.*(\(.*)/g,"$1").trim(),rawproductname=rawproductname.replace(/^[r,p] +/g,"").replace(/\s#\d+|ӿp{0,1}\d+\.{0,1}\d{0,}/,""),rawproductname=rawproductname.replace(/\s[r,p]\d+\.{0,1}\d{0,}|\+[r,p]\d+\.{0,1}\d{0,}v$/,""),rawproductname=rawproductname.replace(/=\d+\.{0,1}\d{0,}|[r,p]\d+\.{0,1}\d{0,}$/,"").replace(/^\(.*\)/,"").replace(/\+$/,"").trim(),!/\$\d+$/.test(product)){""!=pricetype&&null!=pricetype||(pricetype=/\=\d|\+\+/g.test(product.trim())?"purchase":/(\d\s[r,p]\s)|(\s[r,p]\s)|(^r\s)|([r,p]\d+$)/g.test(product.trim().toLowerCase())?"retail":"wholesale");try{/\=\d+/g.test(product)?(unitprice=1,priceTotal=eval(/\=(\d+)/g.exec(product)[1]),displaymultiplier=priceTotal):JSON.parse(cleanasjson).some((function(item,i){if(new RegExp(rawproductname.toLowerCase()).test(item.DrinkName.toLowerCase())){if(transCarton=item.carton,getendvalue.match(/\#/)&&(w_remain=/\#\d+/g.test(getendvalue)?eval(getendvalue.match(/\#\d+/)[0].replace("#","")):0,r_remain=/[r,p]\d+/g.test(getendvalue)?eval(/[r,p](\d+)/g.exec(getendvalue)[1])/item.carton:"",remain=w_remain+r_remain),retail_multiplier=-1==getendvalue.indexOf("p")?0:eval(getendvalue.match(/[r,p]\d+/)[0].replace("p","")),multiplier=whole_multiplier+retail_multiplier/item.carton,"wholesale_purchase_delivered"==appStates[currentAppStateIndex]||"stocktake"==appStates[currentAppStateIndex]){var profitfromwholesale=item.w_price_a*whole_multiplier-item.w_purchase_a*whole_multiplier,profitfromretail=item.p_price_a*retail_multiplier-item.w_purchase_a/item.carton*retail_multiplier;projectedProfit=item.w_price_a*whole_multiplier-item.w_purchase_a*whole_multiplier+profitfromretail}throw""==unitprice?("purchase"==pricetype?(whole_multiplier&&(unitprice=item.w_purchase_a,priceTotal+=item.w_purchase_a*whole_multiplier),retail_multiplier&&(unitprice=Math.round((""==unitprice?item.w_purchase_a+item.p_purchasemarkup_a:unitprice)/item.carton*100)/100,priceTotal+=unitprice*retail_multiplier)):((whole_multiplier||0==whole_multiplier)&&(unitprice=item.w_price_a,priceTotal+=item.w_price_a*whole_multiplier),retail_multiplier&&(unitprice=(""==unitprice?item.w_price_a:unitprice)/item.carton,priceTotal+=unitprice*retail_multiplier)),product=product.replace(new RegExp(`(${getendvalue.replaceAll(/(\+)/gm,"\\$1")})`),`@${unitprice}$1`)):(whole_multiplier&&(priceTotal=unitprice*whole_multiplier),retail_multiplier&&(priceTotal+=unitprice*retail_multiplier),product=product.replace(new RegExp("(@d+.{0,1}d{0,})"),`@${unitprice}`)),BreakException}}))}catch(e){if(e!==BreakException)throw e}var realitemcount=itemcount-1,realeditmultipliersign=null==displaymultiplier?"=":displaymultiplier,displaymultiplier=(whole_multiplier>0?whole_multiplier:0)+(retail_multiplier>0?`p${retail_multiplier}`:"");rowmsg=rowmsg+datetext+"::"+product.replace(/^\d+/g,"").trim()+"::"+multiplier+"÷÷",total+=parseFloat(priceTotal),projectedProfitTotal+=parseFloat(projectedProfit),""==priceTotal&&(priceTotal=""==priceTotal&&/.*=\d+/.test(rawproductname)?rawproductname.match(/\d+$/)[0]:0);let transDate=`${datetext} ${timetext}`,transMsg=product;transUnitPrice=unitprice,transWarehouseName=/\((.*)\)/gm.test(product)?/\((.*)\)/gm.exec(product)[1].toLowerCase():warehouseName.toLowerCase(),transStaffID=staffName.slice(0,2),transType=""==specialTransType?appStates[currentAppStateIndex]:specialTransType,getendvalue=getendvalue||"",response=`${response} <li id="confirmTransactionEntry" name="confirmTransactionEntry_${realitemcount}" >`,response+=`<div class="flex-row"><div class="flex-row"><small>${itemcount}.</small><a id="confirmTransactionEntry" href="#" name="TransactionEditDrinkName_${realitemcount}" title="${rawproductname}" onClick="handleTransEvent(event)" > ${rawproductname} </a>`,response+=`<a id="confirmTransactionEntry" href="#" name="TransactionEditUnitPrice_${realitemcount}" rel="@" type="Kiasi" title="${unitprice}" onClick="handleTransEvent(event)"> @${unitprice}</a>`,response+=`<a id="confirmTransactionEntry" href="#" name="TransactionEditMultiplier_${realitemcount}" rel="${appStateMarks[currentAppStateIndex]}" title="${displaymultiplier}" onClick="handleTransEvent(event)">${appStateMarks[currentAppStateIndex]}${displaymultiplier} = ${priceTotal.toLocaleString("en-US").replace(/\.00/g,"").trim()} </a>`,response+=`<small><a id="confirmTransactionEntry" href="#" name="TransactionEditWarehouse_${realitemcount}" title="${transWarehouseName}" type="Jina La Shop" onClick="handleTransEvent(event)">&nbsp;${"hq"!=transWarehouseName?transWarehouseName:"&nbsp;"}</a></small></div>`,response+=`<div class="buttonholder flex-row"><button id="confirmTransactionEntry" name="TransactionDelete_${realitemcount}" onClick="handleTransEvent(event)">❌</button></div></div></li>`,responseArr.push({transDate:transDate,transWarehouseName:transWarehouseName,transMsg:transMsg,getendvalue:getendvalue,rawproductname:rawproductname,transUnitPrice:transUnitPrice,transStaffID:transStaffID,transType:transType,rawproductname:rawproductname,remain:remain,multiplier:multiplier,transCarton:transCarton,unitprice:unitprice,priceTotal:priceTotal,netpriceTotal:netpriceTotal}),itemcount++,unitprice=""}if(0==responseArr.length||/\$\d+$/.test(product)){remain=/\#\d+/.test(product)?parseFloat(product.match(/\#\d+/)[0].replace("#","")):0,unitprice=1;var rx=new RegExp("\\"+appStateMarks[currentAppStateIndex]+"\\d+");multiplier=rx.test(product)?parseFloat(product.match(rx)[0].replace(appStateMarks[currentAppStateIndex],"")):1,priceTotal=/\=\d+/.test(product)?-1*parseFloat(product.match(/\=\d+/)[0].replace("=","")):multiplier*unitprice,netpriceTotal=0,total+=priceTotal,response=(response+rawproductname+(unitprice>0&&""!=unitprice&&1!=unitprice?"@"+unitprice:"")+" | "+priceTotal.toLocaleString("en-US").replace(/\.00/g,"")).trim()+"\n",date=new Date;let e=`${datetext} ${timetext}`,t=product;transUnitPrice=unitprice,transStaffID=staffName.slice(0,2),transType=""==specialTransType?appStates[currentAppStateIndex]:specialTransType,transWarehouseName=/\((.*)\)/gm.test(product)?/\((.*)\)/gm.exec(product)[1].toLowerCase():warehouseName.toLowerCase(),transCarton=0,getendvalue=getendvalue||"",responseArr.push({transDate:e,transWarehouseName:transWarehouseName,transMsg:t,rawproductname:rawproductname,getendvalue:getendvalue,transUnitPrice:transUnitPrice,transStaffID:transStaffID,transType:transType,transWarehouseName:transWarehouseName,remain:remain,multiplier:multiplier,transCarton:transCarton,unitprice:unitprice,priceTotal:priceTotal,netpriceTotal:netpriceTotal})}try{var sele='li.product[name="'+rawproductname.replaceAll(" ","_")+'"]';document.querySelector(sele).classList.add("processed")}catch(e){}})),finalResponseMsg=`${response}\n<li class="total">TOTAL: `+total.toLocaleString("en-US",{style:"currency",currency:"tzs"}).replace(/\.00/g,"")+" "+(""==projectedProfitTotal?"\n":` <small>&nbsp;(prf: ${projectedProfitTotal.toLocaleString("en-US").replace(/\.00/g,"")})</small>  </li>\n`);var newquery="";for(const e in responseArr)newquery+=`,${responseArr[e].transMsg}`;return newquery=newquery.replace(/^,/,""),JSON.stringify({json_response:responseArr,finalResponseMsg:finalResponseMsg,finalResponseTotal:total,finalQuery:newquery})}function clearvalues(){document.title="Alrada Duka",document.querySelector("#search").value="",document.querySelector("#result_display>ul").innerHTML="",document.querySelectorAll(".enabled").forEach((e=>{e.disabled=!1,e.classList.remove("enabled"),e.classList.add("disabled")})),document.querySelector("#warehouseName").innerHTML="HQ",document.querySelectorAll("#results>li.product.active").forEach((e=>{e.classList.remove("processed")})),productdetails_string="",productdetails_json=[],query="",queryLog="",href="undefined+",sign_mult="",sign_wholesale_remain="",sign_retail_remain="",newlink="",prefix="",iswholesale_purchaseText="",ismult_text="",iswholesale_purchase=!1,isstock=!1,document.querySelector("a.submitbutton").href="",document.querySelector("a.submitbutton").innerHTML="PELEKA",document.querySelector("a.submitbutton").classList.remove("btn-color-wholesale_sale"),closeFilterDialog()}window.onload=function(){try{initializeListeners(),createProductsView()}catch(e){show(e.stack+"-- error trying to load")}},document.querySelector("#warehouseName").innerHTML=warehouseName,-1==window.location.href.indexOf("http://127.0.0.1:3000/")&&document.querySelector("a").addEventListener("click",(e=>{e.preventDefault()}));try{var ALRADADATE=day+" / "+month}catch(e){}</script>